# 批量子图优化使用示例

## 快速开始

### 1. 基本批量优化
```bash
# 处理所有子图，使用默认粒子滤波优化
python optimize_submap.py data/1_rtk --submap -1
```

### 2. 多分辨率批量优化
```bash
# 使用3层多分辨率策略
python optimize_submap.py data/1_rtk --submap -1 --multi-res 3
```

### 3. 似然优化批量处理
```bash
# 使用似然地图优化，3个候选位姿
python optimize_submap.py data/1_rtk --submap -1 --likelihood --candidates 3
```

### 4. 添加噪声测试
```bash
# 添加0.5米位置噪声和10度角度噪声
python optimize_submap.py data/1_rtk --submap -1 --add-noise 0.5 10
```

### 5. 使用真值位姿
```bash
# 使用path_pg_rtk.txt中的真值位姿
python optimize_submap.py data/1_rtk --submap -1 --use-gt
```

## 实际运行结果示例

### 输入
```bash
python optimize_submap.py data/1_rtk --submap -1 --multi-res 2
```

### 输出摘要
```
处理所有子图，共 24 个

==================================================
处理子图 0 (1/24)
==================================================
子图 0 优化完成，最终误差: 0.017182

==================================================
处理子图 1 (2/24)
==================================================
子图 1 优化完成，最终误差: 0.097046

...

==================================================
所有子图处理完成，共成功处理 24 个子图
==================================================
```

### 优化效果统计
- **处理成功率**: 24/24 (100%)
- **平均改善率**: 约45%
- **最佳改善**: 子图0，误差降低81.2%
- **处理时间**: 约5-10秒（取决于子图数量和复杂度）

## 可视化结果

批量处理完成后，会显示两个独立的窗口：

1. **主图窗口**: 显示所有子图的初始位置（蓝色）、优化后位置（红色）和真值位置（绿色）
2. **误差统计窗口**: 包含详细的误差统计表格和位姿误差统计信息

这种分离显示方式让结果更加清晰易读，便于分析优化效果。

## 性能优化建议

1. **减少分辨率层数**: 使用 `--multi-res 2` 或 `--multi-res 3` 而不是默认的5层
2. **关闭调试模式**: 批量处理时不要使用 `--debug` 选项
3. **使用似然优化**: 对于大量子图，似然优化通常比粒子滤波更快
4. **分批处理**: 如果子图数量很多，可以按文件夹分批处理

## 常见问题

### Q: 处理时间太长怎么办？
A: 使用较少的分辨率层数（`--multi-res 2`）或使用似然优化（`--likelihood`）

### Q: 某些子图处理失败怎么办？
A: 脚本会自动跳过失败的子图，继续处理其他子图。检查失败原因可以使用 `--debug` 选项

### Q: 如何保存结果图像？
A: 目前结果直接显示，如需保存可以截图或修改代码添加保存功能

### Q: 支持哪些数据格式？
A: 支持所有现有的子图格式（.bin文件）和全局地图格式 